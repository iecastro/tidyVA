<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic Usage of tidyVA • tidyVA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic Usage of tidyVA">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyVA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tidyva.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/articles/census-data.html">Merging to Census data</a>
    </li>
    <li>
      <a href="../articles/articles/harvest.html">VHA Harvest Datasets</a>
    </li>
    <li>
      <a href="../articles/articles/open-data.html">VA Open Data</a>
    </li>
    <li>
      <a href="../articles/tidyva.html">Basic Usage of tidyVA</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iecastro/tidyVA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Basic Usage of tidyVA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iecastro/tidyVA/blob/master/vignettes/tidyva.Rmd"><code>vignettes/tidyva.Rmd</code></a></small>
      <div class="hidden name"><code>tidyva.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyVA)</code></pre></div>
<p><strong>tidyVA</strong> includes simple features tibbles of VHA geographies.</p>
<p>For this example we’ll use the submarket dataset. This is a <code>tidy</code> dataframe that includes simple features geometry for VHA submarket regions. <a href="https://www.data.va.gov/dataset/veterans-integrated-services-networks-visn-markets-submarkets-sectors-and-counties">data.va.gov</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"submarket"</span>)

<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>submarket, <span class="dt">fill =</span> <span class="ot">NA</span>)</code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Although accurate, this output is not very easy to work with. But, since this is now in tidy format, we can easily filter and manipulate the data. The function <code><a href="../reference/shift_geo.html">shift_geo()</a></code> in <strong>tidyVA</strong> will project and repositon Alaska and Hawaii.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/shift_geo.html">shift_geo</a></span>(submarket) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()
<span class="co">#&gt; Please note: Alaska and Hawaii are being shifted and are not to scale.</span></code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>If you create an R object, this object can be mapped multiple times as individual layers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">submarket &lt;-<span class="st"> </span><span class="kw"><a href="../reference/shift_geo.html">shift_geo</a></span>(submarket)
<span class="co">#&gt; Please note: Alaska and Hawaii are being shifted and are not to scale.</span>

<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="co"># layer 1 is mapped to represent VISNs</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> submarket, <span class="kw">aes</span>(<span class="dt">fill =</span> VISN), <span class="dt">color =</span> <span class="ot">NA</span>) <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="co"># layer 2 is mapped to show all submarkets </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> submarket, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">color =</span> <span class="st">"#ffffff"</span>, <span class="dt">size =</span> .<span class="dv">5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()</code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Alternatively, you can aggregate this dataset to the VISN level, and use as needed. Keep in mind that VHA submarkets in the Caribbean and the Pacific Ocean, are not included - thus, VISNs 21 and 8 are not fully represented.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">visn &lt;-<span class="st"> </span>submarket <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(VISN) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>()

<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> visn, <span class="kw">aes</span>(<span class="dt">fill =</span> VISN), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">"cividis"</span>)</code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div id="spatial-intersection" class="section level1">
<h1 class="hasAnchor">
<a href="#spatial-intersection" class="anchor"></a>Spatial intersection</h1>
<p>A major limitation of the original data is that attributes were present based on a geography’s hierachy. The <code>county</code> dataset has VHA attributes in addition to State and County attributes. The <code>visn</code> dataset only has a VISN attribute:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"states"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"visn"</span>)

<span class="kw">glimpse</span>(visn)
<span class="co">#&gt; Observations: 18</span>
<span class="co">#&gt; Variables: 4</span>
<span class="co">#&gt; $ VISN       &lt;chr&gt; "01", "02", "04", "05", "06", "07", "08", "09", "10...</span>
<span class="co">#&gt; $ Shape_Leng &lt;dbl&gt; 133.20427, 80.95749, 48.00316, 97.94793, 166.43208,...</span>
<span class="co">#&gt; $ Shape_Area &lt;dbl&gt; 19.12818, 15.28981, 14.14237, 12.04503, 21.12288, 3...</span>
<span class="co">#&gt; $ geometry   &lt;MULTIPOLYGON [Â°]&gt; MULTIPOLYGON (((-73.62286 4..., MULTI...</span></code></pre></div>
<p>With simple features we can easily perform geometric operations and gather attributes based on a spatial relationship:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">visn_st &lt;-<span class="st"> </span><span class="kw">st_intersection</span>(states, visn)
<span class="co">#&gt; although coordinates are longitude/latitude, st_intersection assumes that they are planar</span>

<span class="kw">glimpse</span>(visn_st)
<span class="co">#&gt; Observations: 151</span>
<span class="co">#&gt; Variables: 13</span>
<span class="co">#&gt; $ STATEFP    &lt;chr&gt; "09", "50", "23", "25", "33", "36", "44", "09", "34...</span>
<span class="co">#&gt; $ STATENS    &lt;chr&gt; "01779780", "01779802", "01779787", "00606926", "01...</span>
<span class="co">#&gt; $ AFFGEOID   &lt;chr&gt; "0400000US09", "0400000US50", "0400000US23", "04000...</span>
<span class="co">#&gt; $ GEOID      &lt;chr&gt; "09", "50", "23", "25", "33", "36", "44", "09", "34...</span>
<span class="co">#&gt; $ STUSPS     &lt;chr&gt; "CT", "VT", "ME", "MA", "NH", "NY", "RI", "CT", "NJ...</span>
<span class="co">#&gt; $ NAME       &lt;chr&gt; "Connecticut", "Vermont", "Maine", "Massachusetts",...</span>
<span class="co">#&gt; $ LSAD       &lt;chr&gt; "00", "00", "00", "00", "00", "00", "00", "00", "00...</span>
<span class="co">#&gt; $ ALAND      &lt;dbl&gt; 12542638347, 23873467535, 79885221885, 20204442852,...</span>
<span class="co">#&gt; $ AWATER     &lt;dbl&gt; 1815476291, 1031124865, 11748755195, 7130620748, 10...</span>
<span class="co">#&gt; $ VISN       &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", "02", "02...</span>
<span class="co">#&gt; $ Shape_Leng &lt;dbl&gt; 133.20427, 133.20427, 133.20427, 133.20427, 133.204...</span>
<span class="co">#&gt; $ Shape_Area &lt;dbl&gt; 19.12818, 19.12818, 19.12818, 19.12818, 19.12818, 1...</span>
<span class="co">#&gt; $ geometry   &lt;GEOMETRY [Â°]&gt; MULTIPOLYGON (((-72.75991 4..., POLYGON (...</span></code></pre></div>
<p>We can now filter this dataframe by VISN and keep State attributes</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
visn_st <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(VISN <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"01"</span>,<span class="st">"02"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> VISN), <span class="dt">color =</span> <span class="st">"#ffffff"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">"cividis"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Or by State, and keeping VISN attributes. New York for example is mostly within VISN 2, but, there are small catchments areas in the Western and Southern parts of the state that are outside VISN 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
visn_st <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(STUSPS <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"NY"</span>,<span class="st">"CT"</span>,<span class="st">"VT"</span>,<span class="st">"ME"</span>, <span class="st">"MA"</span>,<span class="st">"NH"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> NAME)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="theme-function" class="section level1">
<h1 class="hasAnchor">
<a href="#theme-function" class="anchor"></a>Theme Function</h1>
<p><strong>tidyVA</strong> also includes a ggplot themes: <code><a href="../reference/theme_va.html">theme_va()</a></code>.</p>
<p>This is theme has several possible parameters. The core of this function is <code>theme_ipsum</code> from <a href="https://hrbrmstr.github.io/hrbrthemes/">hrbrthemes</a>, but I have modified and set some defaults.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"visn"</span>)

visn <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/reorder.factor">reorder</a></span>(VISN,Shape_Area), Shape_Area)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"VISN"</span>, <span class="dt">y =</span> <span class="st">"Shape Area"</span>, <span class="dt">caption =</span> <span class="st">"CRS - EPSG:4326"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Shape Area of VA Service Networks"</span>, <span class="dt">subtitle =</span> <span class="st">"This is an example plot"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/theme_va.html">theme_va</a></span>(<span class="dt">grid =</span> <span class="st">"X"</span>)</code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div id="map-theme" class="section level3">
<h3 class="hasAnchor">
<a href="#map-theme" class="anchor"></a>Map Theme</h3>
<p>When plotting maps, you may want to remove the axis text from geom_sf(). For this, the <code>map</code> argument of <code><a href="../reference/theme_va.html">theme_va()</a></code> can be set to TRUE.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">visn_st <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(STUSPS <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"NY"</span>,<span class="st">"CT"</span>,<span class="st">"VT"</span>,<span class="st">"ME"</span>, <span class="st">"MA"</span>,<span class="st">"NH"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> NAME)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="dt">option =</span> <span class="st">"cividis"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">"Caption wil go here"</span>, <span class="dt">fill =</span> <span class="st">""</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Example Plot for Maps"</span>, 
          <span class="dt">subtitle =</span> <span class="st">"Cividis Palette goes well with VA theme"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="../reference/theme_va.html">theme_va</a></span>(<span class="dt">map =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="tidyva_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#spatial-intersection">Spatial intersection</a></li>
      <li><a href="#theme-function">Theme Function</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ivan Castro.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
